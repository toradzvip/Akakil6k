getgenv().Extend_NPC_Ennemy_Hitbox = false
getgenv().FlyMode = false

local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")
local camera = Workspace.CurrentCamera

-- 📌 Tạo GUI
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.ResetOnSpawn = false

-- 🟢 Nút tiêu diệt NPC
local KillButton = Instance.new("TextButton", ScreenGui)
KillButton.Size = UDim2.new(0, 100, 0, 50)
KillButton.Position = UDim2.new(0.3, 0, 0.3, 0)
KillButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)  -- Mặc định đỏ (tắt)
KillButton.Text = "OFF (NPC)"
KillButton.Font = Enum.Font.SourceSansBold
KillButton.TextSize = 18
KillButton.TextColor3 = Color3.fromRGB(255, 255, 255)
KillButton.Active = true
KillButton.Draggable = true

-- 🎯 Tiêu diệt NPC trong phạm vi 200 studs
local function KillNPCs()
    RunService.Heartbeat:Connect(function()
        if getgenv().Extend_NPC_Ennemy_Hitbox then
            for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                local hrp = enemy:FindFirstChild("HumanoidRootPart")
                local humanoid = enemy:FindFirstChildOfClass("Humanoid")

                if hrp and humanoid and humanoid.Health > 0 then
                    local distance = (character.HumanoidRootPart.Position - hrp.Position).Magnitude
                    if distance <= 3000 then  -- ⚠️ Tăng phạm vi lên 200
                        hrp.Size = Vector3.new(75, 75, 75)
                        hrp.Transparency = 0.85
                        hrp.CanCollide = false
                        humanoid.Health = 0
                    end
                end
            end
        end
    end)
end

local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

local runService = game:GetService("RunService")
local flying = false
local jumpHeight = 100  -- Jump height

-- UI
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")

local flyButton = Instance.new("TextButton")
flyButton.Size = UDim2.new(0.2, 0, 0.1, 0)
flyButton.Position = UDim2.new(0.75, 0, 0.8, 0)
flyButton.Text = "Fly V2"
flyButton.Parent = screenGui
flyButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
flyButton.TextScaled = true
flyButton.Font = Enum.Font.SourceSansBold
flyButton.Draggable = true
flyButton.BorderSizePixel = 3
flyButton.BorderColor3 = Color3.fromRGB(255, 255, 255)

-- Function to start flying
local function startFlying()
    if flying then return end
    flying = true
    flyButton.Text = "Stop"
    flyButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)

    runService.RenderStepped:Connect(function()
        if flying then
            humanoidRootPart.Velocity = Vector3.new(0, jumpHeight, 0)
        end
    end)
end

-- Function to stop flying
local function stopFlying()
    flying = false
    flyButton.Text = "Fly V2"
    flyButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
end

-- Toggle flying on button click
flyButton.MouseButton1Click:Connect(function()
    if flying then
        stopFlying()
    else
        startFlying()
    end
end)

