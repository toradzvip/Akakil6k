getgenv().Extend_NPC_Ennemy_Hitbox = false
getgenv().FlyMode = false

local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")
local camera = Workspace.CurrentCamera

-- üìå T·∫°o GUI
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.ResetOnSpawn = false

-- üü¢ N√∫t ti√™u di·ªát NPC
local KillButton = Instance.new("TextButton", ScreenGui)
KillButton.Size = UDim2.new(0, 100, 0, 50)
KillButton.Position = UDim2.new(0.3, 0, 0.3, 0)
KillButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)  -- M·∫∑c ƒë·ªãnh ƒë·ªè (t·∫Øt)
KillButton.Text = "OFF (NPC)"
KillButton.Font = Enum.Font.SourceSansBold
KillButton.TextSize = 18
KillButton.TextColor3 = Color3.fromRGB(255, 255, 255)
KillButton.Active = true
KillButton.Draggable = true

-- üîµ N√∫t bay
local FlyButton = Instance.new("TextButton", ScreenGui)
FlyButton.Size = UDim2.new(0, 100, 0, 50)
FlyButton.Position = UDim2.new(0.3, 0, 0.4, 0)
FlyButton.BackgroundColor3 = Color3.fromRGB(255, 140, 0)  -- M·∫∑c ƒë·ªãnh cam (t·∫Øt)
FlyButton.Text = "OFF (Fly)"
FlyButton.Font = Enum.Font.SourceSansBold
FlyButton.TextSize = 18
FlyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
FlyButton.Active = true
FlyButton.Draggable = true

-- üéØ Ti√™u di·ªát NPC trong ph·∫°m vi 200 studs
local function KillNPCs()
    RunService.Heartbeat:Connect(function()
        if getgenv().Extend_NPC_Ennemy_Hitbox then
            for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                local hrp = enemy:FindFirstChild("HumanoidRootPart")
                local humanoid = enemy:FindFirstChildOfClass("Humanoid")

                if hrp and humanoid and humanoid.Health > 0 then
                    local distance = (character.HumanoidRootPart.Position - hrp.Position).Magnitude
                    if distance <= 600 then  -- ‚ö†Ô∏è TƒÉng ph·∫°m vi l√™n 200
                        hrp.Size = Vector3.new(75, 75, 75)
                        hrp.Transparency = 0.85
                        hrp.CanCollide = false
                        humanoid.Health = 0
                    end
                end
            end
        end
    end)
end

-- ‚úàÔ∏è H·ªá th·ªëng bay ch·ªâ khi gi·ªØ n√∫t ch·∫°y
local flySpeed = 150
local flying = false
local bodyVelocity = Instance.new("BodyVelocity")
bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
bodyVelocity.Velocity = Vector3.new(0, 0, 0)

local function FlyControl()
    if flying then return end
    flying = true
    bodyVelocity.Parent = humanoidRootPart

    RunService.RenderStepped:Connect(function()
        if not getgenv().FlyMode then
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
            bodyVelocity.Parent = nil
            flying = false
            return
        end

        -- üïπÔ∏è Ch·ªâ bay khi gi·ªØ n√∫t ch·∫°y (tr√™n ƒëi·ªán tho·∫°i v√† PC)
        if humanoid.MoveDirection.Magnitude > 0 then
            -- üé• H∆∞·ªõng camera
            local camDirection = camera.CFrame.LookVector
            local moveDir = camDirection * flySpeed

            -- ‚è´ ƒêi·ªÅu khi·ªÉn l√™n/xu·ªëng b·∫±ng g√≥c nh√¨n
            local pitch = camera.CFrame:ToEulerAnglesYXZ()
            local upDownSpeed = pitch * flySpeed

            -- üöÄ ƒêi·ªÅu khi·ªÉn tƒÉng t·ªëc
            if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then
                moveDir = moveDir * 1.5
            end

            -- C·∫≠p nh·∫≠t v·∫≠n t·ªëc
            bodyVelocity.Velocity = moveDir + Vector3.new(0, upDownSpeed, 0)
        else
            bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        end
    end)
end

-- üéõÔ∏è B·∫≠t/t·∫Øt ti√™u di·ªát NPC
KillButton.MouseButton1Click:Connect(function()
    getgenv().Extend_NPC_Ennemy_Hitbox = not getgenv().Extend_NPC_Ennemy_Hitbox

    if getgenv().Extend_NPC_Ennemy_Hitbox then
        KillButton.Text = "ON (NPC)"
        KillButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)  -- Xanh (b·∫≠t)
    else
        KillButton.Text = "OFF (NPC)"
        KillButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)  -- ƒê·ªè (t·∫Øt)
    end
end)

-- ‚úàÔ∏è B·∫≠t/t·∫Øt bay
FlyButton.MouseButton1Click:Connect(function()
    getgenv().FlyMode = not getgenv().FlyMode

    if getgenv().FlyMode then
        FlyButton.Text = "ON (Fly)"
        FlyButton.BackgroundColor3 = Color3.fromRGB(0, 191, 255)  -- Xanh d∆∞∆°ng (b·∫≠t)
        FlyControl()
    else
        FlyButton.Text = "OFF (Fly)"
        FlyButton.BackgroundColor3 = Color3.fromRGB(255, 140, 0)  -- Cam (t·∫Øt)
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.Parent = nil
        flying = false
    end
end)

KillNPCs()

